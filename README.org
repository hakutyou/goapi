#+TITLE: GoApi (gin 的一些 demo)
#+AUTHOR: 白鳥鵠
#+DATE: 2020-05-11

* 安装依赖
#+BEGIN__SRC bash
# 增加缺失的包, 移除没用的包
go mod tidy
# 把依赖拷贝到 ./vendor/ 下
go mod vendor
#+END_SRC

* 配置
#+BEGIN_SRC bash
cp script/debug.yaml .config.yaml
cp script/zap.yaml .zap.yaml
# 修改 .env 文件
#+END_SRC

* 运行
Debug 模式直接运行
#+BEGIN_SRC bash
go run main.go
#+END_SRC

Release 模式添加以下内容
#+BEGIN_SRC golang
// gin start
gin.SetMode(gin.ReleaseMode)
r = gin.Default()
// ....
#+END_SRC

或者使用环境变量
#+BEGIN_SRC bash
GIN_MODE=release go run main.go
#+END_SRC

编译运行
#+BEGIN_SRC bash
# 确保编译环境和正式环境的 GLIBC 版本一致
# 可以通过 `ldd --version` 查看
go build main.go
./goapi
#+END_SRC

* Swagger
** 安装
#+BEGIN_SRC bash
# 安装 swag
go get -u github.com/swaggo/swag/cmd/swag
cd $GOPATH/src/github.com/swaggo/swag/cmd/swag
go install
# 验证安装
swag -v
#+END_SRC

** 部署
#+BEGIN_SRC bash
swag init
#+END_SRC
